<html>
<head>
	<title>Eksempel på opsætning af formular</title>
	<meta charset="iso-8859-1">
	<meta http-equiv="content-type" content="text/html; charset=iso-8859-1">
	<meta http-equiv="cache-control" content="no-cache">
	<meta http-equiv="pragma" content="no-cache">
	<style type="text/css">
	  /*  
	    BODY {margin: 10px; padding: 0px; border: 0px; font-family: Arial, Verdana, Helvetica, sans-serif; color: #000000; font-size: 13px; line-height: 18px;}
	    TD {font-family: Arial, Verdana, Helvetica, sans-serif; color: #000000; font-size: 13px;}
	    A {color: #49A140; font-size: 13px; text-decoration: underline;}
	    FORM {margin: 0px; padding: 0px; border: 0px;}
	    INPUT {font-family: Arial, Verdana, Helvetica, sans-serif; color: #000000; font-size: 13px; height: 22px;}
        SELECT{}
        TEXTAREA {overflow: auto; font-family: Arial, Verdana, Helvetica, sans-serif; color: #000000; font-size: 13px;}
	*/
	</style>
	<script type="text/javascript" src="https://ssl.ditonlinebetalingssystem.dk/integration/ewindow/paymentwindow.js"></script>
	<script type="text/javascript">

	    var iMinorUnit = 0;
	    var iDigits = 0;
			
	    function startPayment(iType)
	    {
	        var objForm = document.getElementById("ePay");
	        var objAmount = objForm.useramount;

	        if (objForm.merchantnumber.value.length < 7) {
	            alert("Du mangler at indtaste dit merchant!");
	            return false;
	        }
            
            if (objForm.orderid.value.length < 1)
		    {
			    alert("Du mangler at angive dit fakturanummer eller referencen til din betaling!");
			    objForm.orderid.focus();
			    return false;
		    }

		    if (objAmount.value.length < 1 || objAmount.value == "") {
		        alert("Indtast venligst beløbet.");
		        objAmount.focus();
		        return false;
		    }
		    else if (objAmount.value.indexOf(".") > -1) {
		        alert("Beløbet må ikke indeholde tegnet '.' (punktum).\n\nDecimaler skal angives med ','. F.eks. 199,95");
		        objAmount.focus();
		        return false;
		    }

		    var amount = trimString(objAmount.value);

		    if (iMinorUnit == "-1") {
		        alert("Du har indtastet et ugyldigt beløb!\n\nBeløbet kan kun indeholde tal.");
		        objAmount.focus();
		        return false;
		    }
		    else if (iDigits > 2) {
		        alert("Du har indtastet et ugyldigt beløb!\n\nBeløbet skal angives med 2 decimaler (du har angivet " + iDigits + " decimaler).");
		        objAmount.focus();
		        return false;
            }
		    else if (iDigits == "1")
		        amount = parseInt(amount) * 10;
            else if (iMinorUnit == "0")
		        amount = parseInt(amount) * 100;


            var descr = "Kundens navn: " + objForm.customername.value + "<br>Evt. kommentar: " + objForm.customercomment.value;
		    
            paymentwindow = new PaymentWindow({

		        'windowstate': String(iType),

		        'paymentcollection': 1,

		        'language': 0,

		        'merchantnumber': objForm.merchantnumber.value,

		        'windowid': 1,

		        'orderid': objForm.orderid.value,

		        'amount': amount,

		        'currency': "208",

		        'description': descr,
				
				'encoding': "ISO-8859-1",

		        'ordertext': "Online betaling af faktura"

		        //'accepturl': objForm.accepturl.value,

		        //'cancelurl': objForm.cancelurl.value

		    });

		    paymentwindow.open();
	    }

	    function trimString(str) {
	        iMinorUnit = 0;
	        iDigits = 0;
	        var tmp = String(str);
	        var returnVal = "";
	        var cVal = "";

	        if (tmp != "") {
	            for (var i = 0; i < tmp.length; i++) {
	                cVal = tmp.substr(i, 1);

	                if (!isNaN(cVal)) {
	                    returnVal = returnVal + cVal;

	                    if (iMinorUnit == "1")
                            iDigits++;
	                }
	                else {
	                    if (cVal != ",") {
	                        iMinorUnit = -1;
	                        break;
	                    }
	                    else
	                        iMinorUnit = 1;
	                }
	            }
	        }

	        return returnVal;
	    }
	    
	    function init()
	    {
	        var sURL = String(window.location);
	        var arrURL = sURL.split("/");
	        var sAcceptURL = "";
	        var objForm = document.getElementById("ePay");
	        var n;
	        
	        for(n = 0; n < arrURL.length - 1; n++)
	            sAcceptURL += arrURL[n] + "/";

	        objForm.cancelurl.value = sURL;
	        objForm.accepturl.value = sAcceptURL + "paymentok.htm";
        }
	    
	    
	</script>
</head>
<body onload="init()">
<form id="ePay">        
        <table>
	    <tr>
	        <td style="width: 100px; background-color: #EEEEEE;"><b>Fakturanummer:</b></td>
	        <td style="width: 250px; background-color: #EEEEEE;"><input type="text" name="orderid" maxlength="20" style="width: 200px;"></td>
	        <td style="width: 250px; background-color: #EEEEEE;">Referencen til betalingen</td>
        </tr>
        <tr>
	        <td style="background-color: #EEEEEE;"><b>Beløb:</b></td>
	        <td style="background-color: #EEEEEE;"><input type="text" name="useramount" style="width: 200px;"></td>
	        <td style="background-color: #EEEEEE;">Beløb angivet i DKK</td>
        </tr>
        <tr>
	        <td style="background-color: #EEEEEE;">Navn:</td>
	        <td style="background-color: #EEEEEE;"><input type="text" name="customername" style="width: 200px;" maxlength="50"></td>
	        <td style="background-color: #EEEEEE;">Kundens navn</td>
        </tr>
        <tr>
	        <td style="background-color: #EEEEEE;">Evt. kommentar:</td>
	        <td style="background-color: #EEEEEE;"><textarea name="customercomment" style="width: 200; height: 50px;"></textarea></td>
	        <td style="background-color: #EEEEEE;">Evt. kommentar fra kunden</td>
        </tr>
        <tr>
	        <td colspan="3" style="text-align: center; padding-top: 10px;"><input type="button" value="Åben i nyt vindue (popup)" onclick="startPayment(1)" style="width: 180px;">&nbsp;&nbsp;&nbsp;<b>eller</b>&nbsp;&nbsp;&nbsp;<input type="button" value="Fortsæt i samme vindue" onclick="startPayment(3)" style="width: 180px;"></td>
        </tr>
        <tr>
            <td colspan="3" style="padding-top: 30px;">
                <table>
                    <tr>
                        <td style="vertical-align: top; padding-right: 20px;"><a href="http://www.epay.dk" target="_blank"><img src="epay-payment-solutions.gif" width="75" height="44" style="border: 0px;" alt="ePay / Payment Solutions"></a></td>
                        <td style="vertical-align: top; font-size: 11px; padding-top: 2px;">
                            <b>SIKKER BETALING</b>
                            <br>
                            <span class="notranslate">ePay / Payment Solutions</span> er PCI certificeret af VISA / Mastercard,<br>og al kommunikation foregår krypteret via en sikker forbindelse.  
                        </td>  
                    </tr>
                </table>
            </td>
        </tr>
    </table>
    <input type="hidden" name="merchantnumber" value="1019865">
    <input type="hidden" name="accepturl" value="">
	<input type="hidden" name="cancelurl" value="">
</form>
</body>
</html>